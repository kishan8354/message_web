<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Display System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f1929;
            --bg-secondary: #192845;
            --bg-panel: #1a2b41;
            --accent: #4696dc;
            --text-primary: #dcf0ff;
            --text-secondary: #b4c8e6;
            --success: #32c878;
            --warning: #ffb43c;
            --error: #ff6464;
            --border: #233759;
            --hover: #5aaafd;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            background: var(--bg-panel);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--accent);
            box-shadow: 0 8px 32px rgba(70, 150, 220, 0.1);
        }

        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            text-align: center;
            background: linear-gradient(45deg, var(--accent), var(--hover));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: var(--accent);
            color: var(--text-primary);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid var(--accent);
        }

        .btn:hover {
            background: var(--hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(70, 150, 220, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            height: calc(100vh - 200px);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        .message-list {
            background: var(--bg-panel);
            border-radius: 16px;
            border: 2px solid var(--accent);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .message-content {
            background: var(--bg-panel);
            border-radius: 16px;
            border: 2px solid var(--accent);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background: var(--accent);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 18px;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) var(--bg-secondary);
        }

        .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .message-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .message-item:hover {
            background: rgba(70, 150, 220, 0.1);
        }

        .message-item.selected {
            background: rgba(70, 150, 220, 0.2);
            border-left: 4px solid var(--accent);
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-sender {
            font-weight: 600;
            font-size: 16px;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .message-subject {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 5px;
        }

        .message-preview {
            font-size: 13px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status-indicators {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-read { background: var(--success); }
        .status-unread { background: var(--warning); }
        .priority-high { background: var(--warning); }
        .priority-critical { background: var(--error); }
        .priority-medium { background: var(--success); }

        .content-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .content-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .content-field {
            margin-bottom: 15px;
        }

        .content-label {
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .content-value {
            color: var(--text-secondary);
        }

        .message-body {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-top: 20px;
        }

        .code-container {
            position: relative;
            margin: 15px 0;
        }

        .code-header {
            background: var(--bg-secondary);
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            border: 1px solid var(--border);
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        pre {
            margin: 0 !important;
            border-radius: 0 0 8px 8px !important;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .text-content {
            white-space: pre-wrap;
            line-height: 1.5;
            font-size: 15px;
            color: var(--text-secondary);
        }

        .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            font-size: 18px;
            text-align: center;
        }

        .status-bar {
            background: var(--bg-panel);
            padding: 10px 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
        }

        .status-text {
            font-size: 14px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
        }

        .error {
            color: var(--error);
            text-align: center;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .controls {
                justify-content: stretch;
            }
            
            .btn {
                flex: 1;
                min-width: 120px;
            }
            
            .message-content {
                margin-top: 20px;
                height: 60vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Message Display System</h1>
            <div class="controls">
                <button class="btn" onclick="refreshMessages()">🔄 Refresh</button>
                <button class="btn" onclick="toggleFilter()">🔍 Filter</button>
                <button class="btn" onclick="markAllRead()">✓ Mark All Read</button>
                <button class="btn" onclick="composeMessage()">✏️ Compose</button>
            </div>
        </div>

        <div class="main-content">
            <div class="message-list">
                <div class="panel-header">Message Inbox (<span id="message-count">0</span>)</div>
                <div class="messages-container" id="messagesList">
                    <div class="loading">Loading messages...</div>
                </div>
            </div>

            <div class="message-content">
                <div class="panel-header">Message Content</div>
                <div class="content-container" id="messageContent">
                    <div class="placeholder">
                        Select a message to view its content
                    </div>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-text" id="statusText">System Status: Connecting to backend...</div>
            <div class="status-indicator" id="statusIndicator"></div>
        </div>
    </div>

    <script>
        class MessageSystem {
            constructor() {
                this.apiKey = 'X7kP9mW3qT2rY8nF4vJ6hL5zB1cD';
                this.apiBaseUrl = window.location.origin;
                this.messages = [];
                this.selectedMessage = null;
                this.refreshInterval = null;
                this.init();
            }

            async init() {
                await this.loadMessages();
                this.startAutoRefresh();
                this.updateStatus('All services operational', 'success');
            }

            async loadMessages() {
                console.log('Loading messages...');
this.messages = await this.fetchMessagesFromAPI();
console.log('Loaded messages from API:', this.messages);
this.renderMessages();
this.updateStatus(`Loaded ${this.messages.length} messages`, 'success');
            }

            // Simulated API call with the messages from the logs
            async fetchMessagesFromAPI() {
                return [
                            {
                                id: 1,
                                sender: "PythonScript",
                                email: "ai@python.org",
                                subject: "Candy Distribution Solution",
                                content: '🤖 AI Solution:\n\n```cpp\n#include <iostream>\n#include <vector>\n\nusing namespace std;\n\n/*\nApproach:\n\nWe perform two passes over the ratings array.\n\n1. First Pass (Left to Right): We assign at least one candy to each child. If a child has a higher rating than their left neighbor, they receive one more candy than their left neighbor.\n\n2. Second Pass (Right to Left): We iterate again. If a child has a higher rating than their right neighbor and their current candy count is not already greater than their right neighbor\'s, we update their candy count to be one more than their right neighbor\'s. This handles cases where a local minimum might have been unfairly penalized in the first pass.\n\nThis ensures that the constraints are met while minimizing the total number of candies.\n*/\n\nclass Solution {\npublic:\n    int candy(vector<int>& ratings) {\n        int n = ratings.size();\n        if (n == 0) return 0; //Handle empty input\n\n        vector<int> candies(n, 1); // Initialize each child with at least one candy\n\n        // First pass: Left to right\n        for (int i = 1; i < n; ++i) {\n            if (ratings[i] > ratings[i - 1]) {\n                candies[i] = candies[i - 1] + 1;\n            }\n        }\n\n        // Second pass: Right to left\n        for (int i = n - 2; i >= 0; --i) {\n            if (ratings[i] > ratings[i + 1] && candies[i] <= candies[i + 1]) {\n                candies[i] = candies[i + 1] + 1;\n            }\n        }\n\n        int totalCandies = 0;\n        for (int candyCount : candies) {\n            totalCandies += candyCount;\n        }\n\n        return totalCandies;\n    }\n};\n\nint main() {\n    Solution sol;\n\n    vector<int> ratings1 = {1, 0, 2};\n    cout << "Minimum candies for ratings " << "{";\n    for (int i = 0; i < ratings1.size(); ++i) {\n        cout << ratings1[i] << (i == ratings1.size() - 1 ? "" : ", ");\n    }\n    cout << "} : " << sol.candy(ratings1) << endl; // Output: 5\n\n\n    vector<int> ratings2 = {1,2,2};\n    cout << "Minimum candies for ratings " << "{";\n    for (int i = 0; i < ratings2.size(); ++i) {\n        cout << ratings2[i] << (i == ratings2.size() - 1 ? "" : ", ");\n    }\n    cout << "} : " << sol.candy(ratings2) << endl; // Output: 4\n\n    vector<int> ratings3 = {};\n    cout << "Minimum candies for ratings {} : " << sol.candy(ratings3) << endl; //Output 0\n\n    return 0;\n}\n```',
                                timestamp: new Date('2025-06-02T16:01:54.205400').toISOString(),
                                status: "unread",
                                priority: "high",
                                type: "code"
                            },
                            {
                                id: 2,
                                sender: "PythonScript",
                                email: "ai@python.org",
                                subject: "Extracted Text Content",
                                content: '📝 Extracted Text:\n\nAPIMes X | G howpa X | w& messa @ Messag X | & LeetCo Cand J Grok\n\no-\n\n23 message-web-4.onrender.com\n\nS Refresh > Filter V Mark All Read «> Compose\n\nMessage Inbox (4) Message Content\n\nJohn Smith ee HIGH\n\nPython Script Update\n\n"Here\'s the updated Python script: [Code Block] This should...\n6/2/2025, 4:02:52 PM TEXT\n\nSarah Johnson\n\nC++ Algorithm Implementation\n\nGedkeuthis estinized eathgclgedineleata Ted P- Scheduled server maintenance will occur tonight from 10:00 PM to 2:00 AM.\n\n6/2/2025, 3:02:52 PM\nDuring this time, services may be temporarily unavailable.\n\nDevelopment Team e\n\nWe appreciate your understanding.\nMeeting Notes Ht of &\n\n"Here are the key points from today\'s meeting: « Project tim...\n\nSystem Status: Using demo data - API unavailable\n\n16:02\n02-06-2025\n\nENG\n\nZ~ ti\naN ® 0) @',
                                timestamp: new Date('2025-06-02T16:02:58.000091').toISOString(),
                                status: "unread",
                                priority: "medium",
                                type: "text"
                            },
                            {
                                id: 3,
                                sender: "John Smith",
                                email: "john.smith@example.com",
                                subject: "Python Script Update",
                                content: `Here's the updated Python script:\n\n\`\`\`python\nimport requests\nimport json\n\ndef fetch_data(api_url):\n    response = requests.get(api_url)\n    if response.status_code == 200:\n        return response.json()\n    return None\n\ndata = fetch_data("https://api.example.com/data")\nprint(json.dumps(data, indent=2))\n\`\`\`\n\nThis should work better for our needs.`,
                                timestamp: new Date().toISOString(),
                                status: "unread",
                                priority: "high",
                                type: "code"
                            },
                            {
                                id: 4,
                                sender: "Sarah Johnson",
                                email: "sarah.j@business.com",
                                subject: "C++ Algorithm Implementation",
                                content: `Check out this optimized sorting algorithm:\n\n\`\`\`cpp\n#include <iostream>\n#include <vector>\n#include <algorithm>\n\nvoid quickSort(std::vector<int>& arr, int low, int high) {\n    if (low < high) {\n        int pi = partition(arr, low, high);\n        quickSort(arr, low, pi - 1);\n        quickSort(arr, pi + 1, high);\n    }\n}\n\nint main() {\n    std::vector<int> data = {64, 34, 25, 12, 22, 11, 90};\n    quickSort(data, 0, data.size() - 1);\n    return 0;\n}\n\`\`\`\n\nPerformance looks great!`,
                                timestamp: new Date(Date.now() - 3600000).toISOString(),
                                status: "read",
                                priority: "medium",
                                type: "code"
                            }
                        ];
            }

            getDemoMessages() {
                return [];
                    // {
                    //     id: 5,
                    //     sender: "Development Team",
                    //     email: "dev@company.com",
                    //     subject: "Meeting Notes",
                    //     content: "Here are the key points from today's meeting:\n\n• Project timeline updated\n• New features approved\n• Budget allocation confirmed\n• Next review scheduled for Friday\n\nPlease review and let me know if anything is missing.",
                    //     timestamp: new Date(Date.now() - 7200000).toISOString(),
                    //     status: "unread",
                    //     priority: "medium",
                    //     type: "text"
                    // },
                    // {
                    //     id: 6,
                    //     sender: "System Alert",
                    //     email: "alerts@system.com",
                    //     subject: "Server Maintenance",
                    //     content: "Scheduled server maintenance will occur tonight from 10:00 PM to 2:00 AM.\n\nDuring this time, services may be temporarily unavailable.\n\nWe appreciate your understanding.",
                    //     timestamp: new Date(Date.now() - 86400000).toISOString(),
                    //     status: "unread",
                    //     priority: "high",
                    //     type: "text"
                    // }
                // ];
            }

            renderMessages() {
                console.log('Rendering messages:', this.messages); 
                const container = document.getElementById('messagesList');
                const countElement = document.getElementById('message-count');
                
                countElement.textContent = this.messages.length;

                if (this.messages.length === 0) {
                    container.innerHTML = '<div class="loading">No messages found</div>';
                    return;
                }

                // Sort messages by timestamp (newest first)
                const sortedMessages = [...this.messages].sort((a, b) => 
                    new Date(b.timestamp) - new Date(a.timestamp)
                );

                container.innerHTML = sortedMessages.map(message => `
                    <div class="message-item ${this.selectedMessage?.id === message.id ? 'selected' : ''}" 
                         onclick="messageSystem.selectMessage(${message.id})">
                        <div class="message-header">
                            <div class="message-sender">${this.escapeHtml(message.sender)}</div>
                            <div class="status-indicators">
                                <div class="status-dot status-${message.status}"></div>
                                <div class="status-dot priority-${message.priority}"></div>
                            </div>
                        </div>
                        <div class="message-subject">${this.escapeHtml(message.subject)}</div>
                        <div class="message-preview">${this.getPreview(message.content)}</div>
                        <div class="message-time">${this.formatTime(message.timestamp)}</div>
                    </div>
                `).join('');
            }

            selectMessage(messageId) {
                this.selectedMessage = this.messages.find(msg => msg.id === messageId);
                this.renderMessages(); // Re-render to update selection
                this.renderMessageContent();
                
                // Mark as read
                if (this.selectedMessage.status === 'unread') {
                    this.selectedMessage.status = 'read';
                    this.markMessageAsRead(messageId);
                }
            }

            renderMessageContent() {
                const container = document.getElementById('messageContent');
                
                if (!this.selectedMessage) {
                    container.innerHTML = '<div class="placeholder">Select a message to view its content</div>';
                    return;
                }

                const msg = this.selectedMessage;
                const processedContent = this.processContent(msg.content, msg.type);

                container.innerHTML = `
                    <div class="content-header">
                        <div class="content-field">
                            <div class="content-label">From:</div>
                            <div class="content-value">${this.escapeHtml(msg.sender)} &lt;${this.escapeHtml(msg.email)}&gt;</div>
                        </div>
                        <div class="content-field">
                            <div class="content-label">Subject:</div>
                            <div class="content-value">${this.escapeHtml(msg.subject)}</div>
                        </div>
                        <div class="content-field">
                            <div class="content-label">Received:</div>
                            <div class="content-value">${this.formatTime(msg.timestamp)}</div>
                        </div>
                        <div class="content-field">
                            <div class="content-label">Priority:</div>
                            <div class="content-value" style="color: ${this.getPriorityColor(msg.priority)}">${msg.priority.toUpperCase()}</div>
                        </div>
                        <div class="content-field">
                            <div class="content-label">Type:</div>
                            <div class="content-value">${msg.type.toUpperCase()}</div>
                        </div>
                    </div>
                    <div class="message-body">
                        ${processedContent}
                    </div>
                `;

                // Highlight code after rendering
                Prism.highlightAll();
            }

            processContent(content, messageType) {
                // For text-only messages
                if (messageType === 'text') {
                    const escapedContent = this.escapeHtml(content);
                    return `<div class="text-content">${escapedContent.replace(/\n/g, '<br>')}</div>`;
                }
                
                // For messages with code blocks
                const codeBlockRegex = /```(\w+)?\n([\s\S]*?)```/g;
                let processedContent = '';
                let lastIndex = 0;
                let match;

                while ((match = codeBlockRegex.exec(content)) !== null) {
                    // Add text before the code block
                    if (match.index > lastIndex) {
                        const textSegment = content.substring(lastIndex, match.index);
                        const escapedText = this.escapeHtml(textSegment);
                        processedContent += `<div class="text-content">${escapedText.replace(/\n/g, '<br>')}</div>`;
                    }
                    
                    // Process the code block
                    const language = match[1] || 'text';
                    const code = match[2];
                    const codeId = 'code_' + Math.random().toString(36).substr(2, 9);
                    
                    processedContent += `
                        <div class="code-container">
                            <div class="code-header">
                                <span>${language.toUpperCase()} Code</span>
                                <button class="copy-btn" onclick="messageSystem.copyCode('${codeId}')">Copy</button>
                            </div>
                            <pre id="${codeId}"><code class="language-${language}">${this.escapeHtml(code)}</code></pre>
                        </div>
                    `;
                    
                    lastIndex = codeBlockRegex.lastIndex;
                }

                // Add any remaining text after the last code block
                if (lastIndex < content.length) {
                    const remainingText = content.substring(lastIndex);
                    const escapedText = this.escapeHtml(remainingText);
                    processedContent += `<div class="text-content">${escapedText.replace(/\n/g, '<br>')}</div>`;
                }

                return processedContent;
            }

            copyCode(codeId) {
                const codeElement = document.getElementById(codeId);
                const code = codeElement.textContent;
                
                navigator.clipboard.writeText(code).then(() => {
                    this.showNotification('Code copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy code:', err);
                });
            }

            async markMessageAsRead(messageId) {
                // Simulated API call to mark message as read
                try {
                    const message = this.messages.find(m => m.id === messageId);
                    if (message) {
                        message.status = 'read';
                        this.renderMessages();
                    }
                } catch (error) {
                    console.error('Failed to mark message as read:', error);
                }
            }

            startAutoRefresh() {
                this.refreshInterval = setInterval(() => {
                    this.loadMessages();
                }, 30000); // Refresh every 30 seconds
            }

            stopAutoRefresh() {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                }
            }

            updateStatus(message, type) {
                const statusText = document.getElementById('statusText');
                const statusIndicator = document.getElementById('statusIndicator');
                
                statusText.textContent = `System Status: ${message}`;
                statusIndicator.className = `status-indicator ${type}`;
            }

            getPriorityColor(priority) {
                switch(priority) {
                    case 'high': return 'var(--warning)';
                    case 'critical': return 'var(--error)';
                    default: return 'var(--success)';
                }
            }

            formatTime(timestamp) {
                return new Date(timestamp).toLocaleString();
            }

            getPreview(content) {
                const text = content.replace(/```[\s\S]*?```/g, '[Code Block]');
                return text.substring(0, 100) + (text.length > 100 ? '...' : '');
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showNotification(message) {
                // Simple notification - can be enhanced
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--success);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 8px;
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }

        // Global functions for button actions
        function refreshMessages() {
            messageSystem.loadMessages();
        }

        function toggleFilter() {
            messageSystem.showNotification('Filter feature coming soon!');
        }

        function markAllRead() {
            messageSystem.messages.forEach(msg => {
                if (msg.status === 'unread') {
                    msg.status = 'read';
                }
            });
            messageSystem.renderMessages();
            messageSystem.showNotification('All messages marked as read');
        }

        function composeMessage() {
            messageSystem.showNotification('Compose feature coming soon!');
        }

        // Initialize the system
        const messageSystem = new MessageSystem();

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>